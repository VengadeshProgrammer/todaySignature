<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>High-Entropy WebGL Fingerprint</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: system-ui, sans-serif; padding: 24px; }
  pre { background:#f4f4f4; padding:12px; border-radius:8px; }
  button { padding:10px 14px; border:1px solid #ccc; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>
<h1>High-Entropy WebGL Fingerprint</h1>
<p>Open console. Values differ across browsers, remain stable within one.</p>
<button id="run">Compute</button>
<pre id="out">Press the button...</pre>

<script>
function getHighEntropyWebGLFingerprint(size = 16) {
  try {
    const canvas = document.createElement('canvas');
    const gl = canvas.getContext('webgl', { preserveDrawingBuffer: true }) 
           || canvas.getContext('experimental-webgl');
    if (!gl) return [];

    canvas.width = size;
    canvas.height = size;
    gl.viewport(0, 0, size, size);

    // create texture for dependent lookups
    const tex = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, tex);
    const texData = new Uint8Array(size * size * 3);
    for (let i = 0; i < texData.length; i++) texData[i] = (i * 37) % 256;
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, size, size, 0, gl.RGB, gl.UNSIGNED_BYTE, texData);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);

    const vs = `
      attribute vec2 a_position;
      varying vec2 v_uv;
      void main() {
        v_uv = (a_position + 1.0) * 0.5;
        gl_Position = vec4(a_position, 0.0, 1.0);
      }
    `;

    const fs = `
      precision highp float;
      varying vec2 v_uv;
      uniform sampler2D tex;
      void main() {
        vec2 uv = v_uv;
        vec3 base = texture2D(tex, uv).rgb;
        float f = sin(dot(base, vec3(12.9898,78.233,45.164))) * 43758.5453;
        float v = fract(f);
        v = pow(v, 3.0) + sin(v * 31.4159) * 0.3;
        gl_FragColor = vec4(fract(v*base.rg), fract(v*1.111), 1.0);
      }
    `;

    function compile(src, type) {
      const sh = gl.createShader(type);
      gl.shaderSource(sh, src);
      gl.compileShader(sh);
      if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS))
        throw new Error(gl.getShaderInfoLog(sh));
      return sh;
    }

    const prog = gl.createProgram();
    gl.attachShader(prog, compile(vs, gl.VERTEX_SHADER));
    gl.attachShader(prog, compile(fs, gl.FRAGMENT_SHADER));
    gl.linkProgram(prog);
    gl.useProgram(prog);

    const posLoc = gl.getAttribLocation(prog, 'a_position');
    const buf = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buf);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 3,-1, -1,3]), gl.STATIC_DRAW);
    gl.enableVertexAttribArray(posLoc);
    gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);

    gl.drawArrays(gl.TRIANGLES, 0, 3);
    const pixels = new Uint8Array(size * size * 4);
    gl.readPixels(0, 0, size, size, gl.RGBA, gl.UNSIGNED_BYTE, pixels);

    const pattern = [];
    for (let i = 0; i < pixels.length; i += 4) {
      const avg = (pixels[i] + pixels[i+1] + pixels[i+2]) / 3;
      pattern.push(Math.round(avg));
    }
    return pattern;
  } catch (err) {
    console.warn('WebGL fingerprint error:', err);
    return [];
  }
}

document.getElementById('run').onclick = () => {
  const data = getHighEntropyWebGLFingerprint(16);
  console.log('High-entropy WebGL fingerprint:', data);
  document.getElementById('out').textContent = JSON.stringify(data, null, 2);
};
</script>
</body>
</html>
