<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Raw WebGL Fingerprint</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; padding: 28px; }
    pre { background:#f5f5f5; padding:12px; border-radius:8px; }
    button { padding:10px 14px; border-radius:6px; border:1px solid #ccc; background:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Raw WebGL Fingerprint (numeric)</h1>
  <p>Click to compute. Check console for raw values.</p>
  <button id="run">Compute WebGL Fingerprint</button>
  <pre id="out">Press the button...</pre>

  <script>
  function getWebGLNumericFingerprint(size = 8) {
    try {
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      if (!gl) return [];

      canvas.width = size;
      canvas.height = size;
      gl.viewport(0, 0, size, size);

      // Stable shaders (no random seeds)
      const vs = 'attribute vec2 a_position; void main(){ gl_Position = vec4(a_position,0.0,1.0); }';
      const fs = `
        precision mediump float;
        void main(){
          vec2 p = gl_FragCoord.xy * 0.12345;
          float v = fract(sin(dot(p, vec2(12.9898,78.233))) * 43758.5453);
          v += sin(p.x * 0.314159 + v*37.0) * 0.1;
          v = fract(v);
          gl_FragColor = vec4(v, fract(v*1.234), fract(v*2.345), 1.0);
        }
      `;

      function compile(src, type) {
        const sh = gl.createShader(type);
        gl.shaderSource(sh, src);
        gl.compileShader(sh);
        if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {
          throw new Error(gl.getShaderInfoLog(sh));
        }
        return sh;
      }

      const vsh = compile(vs, gl.VERTEX_SHADER);
      const fsh = compile(fs, gl.FRAGMENT_SHADER);
      const prog = gl.createProgram();
      gl.attachShader(prog, vsh);
      gl.attachShader(prog, fsh);
      gl.linkProgram(prog);
      gl.useProgram(prog);

      const posLoc = gl.getAttribLocation(prog, 'a_position');
      const buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 3,-1, -1,3]), gl.STATIC_DRAW);
      gl.enableVertexAttribArray(posLoc);
      gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);
      gl.drawArrays(gl.TRIANGLES, 0, 3);

      const pixels = new Uint8Array(size * size * 4);
      gl.readPixels(0, 0, size, size, gl.RGBA, gl.UNSIGNED_BYTE, pixels);

      // Convert the pixel bytes to numeric pattern (mean of R, G, B per pixel)
      const pattern = [];
      for (let i = 0; i < pixels.length; i += 4) {
        const avg = (pixels[i] + pixels[i+1] + pixels[i+2]) / 3;
        pattern.push(Math.round(avg));
      }

      return pattern;
    } catch (e) {
      console.warn('WebGL failed:', e.message);
      return [];
    }
  }

  function computeAndPrint() {
    const out = document.getElementById('out');
    const pattern = getWebGLNumericFingerprint(16); // 16Ã—16 = 256 pixels
    console.log('Raw WebGL numeric fingerprint:', pattern);
    out.textContent = JSON.stringify(pattern, null, 2);
  }

  document.getElementById('run').addEventListener('click', computeAndPrint);
  </script>
</body>
</html>
